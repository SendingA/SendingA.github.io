{{ define "main" }}
<article class="article article-simple">
  <div class="article-container pt-3">
    <h1>{{ .Title }}</h1>
    
    {{ with .Params.summary }}
    <div class="article-style">
      <p>{{ . }}</p>
    </div>
    {{ end }}

    <!-- Compact Filter Bar with Calendar Icon -->
    <div class="news-filter-bar mb-4">
      <div class="filter-actions">
        <button class="btn-calendar-toggle" id="calendar-toggle-btn" title="Filter by date">
          <i class="fas fa-calendar-alt me-2"></i>
          <span>Filter by Date</span>
        </button>
        <button class="btn-reset-filter" id="reset-filter-btn" style="display: none;">
          <i class="fas fa-times me-1"></i>
          <span>Clear Filter</span>
        </button>
      </div>
      <div class="filter-info" id="filter-info">
        <span class="text-muted">Showing all news</span>
      </div>
    </div>

    <!-- Collapsible Calendar Filter (Hidden by default) -->
    <div class="news-filter-section mb-4" id="calendar-filter-section" style="display: none;">
      <div class="row">
        <div class="col-lg-12">
          <div class="calendar-filter-container">
            <div class="calendar-header">
              <h4 class="filter-title">
                <i class="fas fa-calendar-alt me-2"></i>Select Date
              </h4>
              <button class="btn-close-calendar" id="close-calendar-btn">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="calendar-grid" id="calendar-filter">
              {{ $currentYear := now.Year }}
              {{ $years := slice }}
              
              <!-- Collect all years from news posts -->
              {{ range .Site.RegularPages }}
                {{ if eq .Section "news" }}
                  {{ $year := .Date.Year }}
                  {{ if not (in $years $year) }}
                    {{ $years = $years | append $year }}
                  {{ end }}
                {{ end }}
              {{ end }}
              
              {{ $years = sort $years "value" "desc" }}
              
              <!-- Generate calendar for each year -->
              {{ range $years }}
                {{ $year := . }}
                <div class="year-section">
                  <h5 class="year-label">{{ $year }}</h5>
                  <div class="months-grid">
                    {{ range $month := (seq 12) }}
                      {{ $monthStr := printf "%d-%02d" $year $month }}
                      {{ $hasNews := false }}
                      {{ $newsCount := 0 }}
                      {{ $newsDates := slice }}
                      
                      <!-- Check if there are news in this month and collect dates -->
                      {{ range $.Site.RegularPages }}
                        {{ if eq .Section "news" }}
                          {{ if eq (.Date.Format "2006-01") $monthStr }}
                            {{ $hasNews = true }}
                            {{ $newsCount = add $newsCount 1 }}
                            {{ $newsDates = $newsDates | append (.Date.Format "2006-01-02") }}
                          {{ end }}
                        {{ end }}
                      {{ end }}
                      
                      {{ $monthName := (time (printf "%d-%02d-01" $year $month)).Format "Jan" }}
                      {{ if $hasNews }}
                        <button class="month-btn active" data-month="{{ $monthStr }}" data-count="{{ $newsCount }}" data-dates='{{ $newsDates | jsonify }}'>
                          <span class="month-name">{{ $monthName }}</span>
                          <span class="news-badge">{{ $newsCount }}</span>
                        </button>
                      {{ else }}
                        <button class="month-btn disabled" disabled>
                          <span class="month-name">{{ $monthName }}</span>
                        </button>
                      {{ end }}
                    {{ end }}
                  </div>
                  
                  <!-- Day selector for selected month -->
                  <div class="days-selector" id="days-{{ $year }}" style="display: none;">
                    <h6 class="days-title">Select specific date:</h6>
                    <div class="days-grid"></div>
                  </div>
                </div>
              {{ end }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- News Timeline -->
    <div class="news-timeline-section">
      <h3 class="section-heading mb-4">
        <i class="fas fa-newspaper me-2"></i>
        <span id="timeline-title">Recent Updates</span>
        <span class="news-count-badge" id="news-count-badge"></span>
      </h3>
      
      <div class="news-timeline" id="news-container">
        {{ $paginator := .Paginate (where .Site.RegularPages "Section" "news").ByDate.Reverse }}
        
        {{ if eq (len $paginator.Pages) 0 }}
          <div class="no-news-message">
            <i class="fas fa-info-circle"></i>
            <p>No news items found.</p>
          </div>
        {{ end }}
        
        {{ range $paginator.Pages }}
        <div class="news-item" data-month="{{ .Date.Format "2006-01" }}" data-date="{{ .Date.Format "2006-01-02" }}">
          <div class="news-date-marker">
            <div class="date-circle">
              <span class="day">{{ .Date.Format "02" }}</span>
              <span class="month">{{ .Date.Format "Jan" }}</span>
              <span class="year">{{ .Date.Format "2006" }}</span>
            </div>
            <div class="timeline-line"></div>
          </div>
          
          <div class="news-content-card">
            <div class="card-header">
              <h4 class="news-title">
                <a href="{{ .RelPermalink }}">{{ .Title }}</a>
              </h4>
              <span class="news-date">{{ .Date.Format "January 2, 2006" }}</span>
            </div>
            
            <div class="card-body">
              {{ with .Params.summary }}
                <p class="news-summary">{{ . }}</p>
              {{ end }}
              
              {{ with .Params.tags }}
              <div class="news-tags">
                {{ range . }}
                  <span class="tag-badge">{{ . }}</span>
                {{ end }}
              </div>
              {{ end }}
            </div>
            
            <div class="card-footer">
              <a href="{{ .RelPermalink }}" class="read-more-link">
                Read more <i class="fas fa-arrow-right ms-1"></i>
              </a>
            </div>
          </div>
        </div>
        {{ end }}
      </div>

      <!-- Pagination -->
      {{ if gt $paginator.TotalPages 1 }}
      <nav class="pagination-nav mt-5">
        <ul class="pagination justify-content-center">
          {{ if $paginator.HasPrev }}
            <li class="page-item">
              <a class="page-link" href="{{ $paginator.Prev.URL }}" aria-label="Previous">
                <i class="fas fa-chevron-left"></i>
              </a>
            </li>
          {{ else }}
            <li class="page-item disabled">
              <span class="page-link"><i class="fas fa-chevron-left"></i></span>
            </li>
          {{ end }}
          
          {{ range $paginator.Pagers }}
            {{ if eq . $paginator }}
              <li class="page-item active">
                <span class="page-link">{{ .PageNumber }}</span>
              </li>
            {{ else }}
              <li class="page-item">
                <a class="page-link" href="{{ .URL }}">{{ .PageNumber }}</a>
              </li>
            {{ end }}
          {{ end }}
          
          {{ if $paginator.HasNext }}
            <li class="page-item">
              <a class="page-link" href="{{ $paginator.Next.URL }}" aria-label="Next">
                <i class="fas fa-chevron-right"></i>
              </a>
            </li>
          {{ else }}
            <li class="page-item disabled">
              <span class="page-link"><i class="fas fa-chevron-right"></i></span>
            </li>
          {{ end }}
        </ul>
      </nav>
      {{ end }}
    </div>
  </div>
</article>

<style>
/* Compact Filter Bar */
.news-filter-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem;
  background: #f8f9fa;
  border-radius: 12px;
  border: 1px solid #e9ecef;
}

.filter-actions {
  display: flex;
  gap: 0.75rem;
  align-items: center;
}

.btn-calendar-toggle {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border: none;
  border-radius: 10px;
  padding: 0.6rem 1.25rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 2px 8px rgba(102, 126, 234, 0.25);
}

.btn-calendar-toggle:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.btn-reset-filter {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  background: #dc3545;
  color: white;
  border: none;
  border-radius: 10px;
  padding: 0.6rem 1.25rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 2px 8px rgba(220, 53, 69, 0.25);
}

.btn-reset-filter:hover {
  background: #c82333;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
}

.filter-info {
  color: #6c757d;
  font-weight: 500;
  font-size: 0.95rem;
}

.filter-info.active {
  color: #667eea;
  font-weight: 600;
}

/* Collapsible Calendar Section */
.news-filter-section {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 15px;
  padding: 1.5rem;
  box-shadow: 0 8px 30px rgba(102, 126, 234, 0.3);
  animation: slideDown 0.3s ease;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.calendar-filter-container {
  background: white;
  border-radius: 12px;
  padding: 1.5rem;
}

.calendar-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
}

.filter-title {
  color: #667eea;
  font-size: 1.25rem;
  font-weight: 700;
  margin: 0;
  display: flex;
  align-items: center;
}

.btn-close-calendar {
  background: none;
  border: none;
  color: #6c757d;
  font-size: 1.5rem;
  cursor: pointer;
  padding: 0.25rem 0.5rem;
  transition: all 0.3s ease;
  border-radius: 6px;
}

.btn-close-calendar:hover {
  background: #f8f9fa;
  color: #dc3545;
}

.year-section {
  margin-bottom: 1.5rem;
}

.year-label {
  color: #333;
  font-size: 1.1rem;
  font-weight: 600;
  margin-bottom: 0.75rem;
  padding-left: 0.5rem;
  border-left: 4px solid #667eea;
}

.months-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
  gap: 0.6rem;
}

.month-btn {
  position: relative;
  background: #f8f9fa;
  border: 2px solid #e9ecef;
  border-radius: 10px;
  padding: 0.6rem 0.4rem;
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: 500;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.25rem;
}

.month-btn:not(.disabled):hover {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-color: #667eea;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.month-btn.active {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-color: #667eea;
}

.month-btn.disabled {
  background: #f8f9fa;
  color: #ced4da;
  cursor: not-allowed;
  opacity: 0.5;
}

.month-btn.selected {
  background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
  color: white;
  border-color: #28a745;
  box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
  transform: scale(1.05);
}

.month-name {
  font-size: 0.85rem;
  font-weight: 600;
}

.news-badge {
  background: rgba(255, 255, 255, 0.9);
  color: #667eea;
  border-radius: 10px;
  padding: 0.125rem 0.5rem;
  font-size: 0.7rem;
  font-weight: 700;
  min-width: 22px;
}

.month-btn.selected .news-badge {
  color: #28a745;
}

.month-btn:hover .news-badge {
  background: rgba(255, 255, 255, 1);
}

/* Days Selector */
.days-selector {
  margin-top: 1rem;
  padding: 1rem;
  background: #f8f9fa;
  border-radius: 10px;
  animation: slideDown 0.3s ease;
}

.days-title {
  color: #667eea;
  font-size: 0.95rem;
  font-weight: 600;
  margin-bottom: 0.75rem;
}

.days-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(45px, 1fr));
  gap: 0.5rem;
}

.day-btn {
  background: white;
  border: 2px solid #e9ecef;
  border-radius: 8px;
  padding: 0.5rem;
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: 600;
  text-align: center;
  color: #333;
  font-size: 0.85rem;
}

.day-btn:hover {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-color: #667eea;
  transform: scale(1.05);
}

.day-btn.selected {
  background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
  color: white;
  border-color: #28a745;
  box-shadow: 0 2px 8px rgba(40, 167, 69, 0.4);
}

.day-btn.disabled {
  background: #f8f9fa;
  color: #ced4da;
  cursor: not-allowed;
  opacity: 0.5;
}

/* News Timeline Styles */
.section-heading {
  color: #333;
  font-size: 1.75rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 1rem;
  padding-bottom: 1rem;
  border-bottom: 3px solid #667eea;
}

.news-count-badge {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 0.25rem 0.75rem;
  border-radius: 20px;
  font-size: 0.875rem;
  font-weight: 600;
  min-width: 40px;
  text-align: center;
}

.news-timeline {
  position: relative;
  padding-left: 1rem;
}

.news-item {
  display: flex;
  margin-bottom: 2rem;
  opacity: 1;
  transition: all 0.3s ease;
}

.news-item.hidden {
  display: none;
}

.news-date-marker {
  position: relative;
  margin-right: 2rem;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.date-circle {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 12px;
  padding: 0.75rem;
  color: white;
  text-align: center;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
  min-width: 70px;
  z-index: 2;
}

.date-circle .day {
  display: block;
  font-size: 1.5rem;
  font-weight: 700;
  line-height: 1;
}

.date-circle .month {
  display: block;
  font-size: 0.8rem;
  font-weight: 500;
  opacity: 0.9;
  text-transform: uppercase;
}

.date-circle .year {
  display: block;
  font-size: 0.7rem;
  font-weight: 500;
  opacity: 0.8;
  margin-top: 0.125rem;
}

.timeline-line {
  position: absolute;
  top: 80px;
  left: 50%;
  transform: translateX(-50%);
  width: 3px;
  height: calc(100% + 2rem);
  background: linear-gradient(180deg, #667eea 0%, rgba(102, 126, 234, 0.1) 100%);
}

.news-item:last-child .timeline-line {
  display: none;
}

.news-content-card {
  flex: 1;
  background: white;
  border-radius: 15px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  transition: all 0.3s ease;
  overflow: hidden;
  border: 1px solid #e9ecef;
}

.news-content-card:hover {
  box-shadow: 0 8px 30px rgba(102, 126, 234, 0.2);
  transform: translateY(-4px);
}

.card-header {
  padding: 1.5rem;
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
  border-bottom: 1px solid #e9ecef;
}

.news-title {
  margin: 0 0 0.5rem 0;
  font-size: 1.25rem;
  font-weight: 700;
}

.news-title a {
  color: #333;
  text-decoration: none;
  transition: color 0.3s ease;
}

.news-title a:hover {
  color: #667eea;
}

.news-date {
  color: #6c757d;
  font-size: 0.875rem;
  font-weight: 500;
}

.card-body {
  padding: 1.5rem;
}

.news-summary {
  color: #555;
  line-height: 1.6;
  margin-bottom: 1rem;
}

.news-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.tag-badge {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 0.25rem 0.75rem;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 600;
}

.card-footer {
  padding: 1rem 1.5rem;
  background: #f8f9fa;
  border-top: 1px solid #e9ecef;
}

.read-more-link {
  color: #667eea;
  text-decoration: none;
  font-weight: 600;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
}

.read-more-link:hover {
  color: #764ba2;
  transform: translateX(4px);
}

.no-news-message {
  text-align: center;
  padding: 3rem;
  color: #6c757d;
}

.no-news-message i {
  font-size: 3rem;
  margin-bottom: 1rem;
  display: block;
}

/* Pagination Styles */
.pagination-nav {
  margin-top: 3rem;
}

.pagination {
  gap: 0.5rem;
}

.page-link {
  border-radius: 8px;
  border: 2px solid #e9ecef;
  color: #667eea;
  font-weight: 600;
  padding: 0.5rem 1rem;
  transition: all 0.3s ease;
}

.page-link:hover {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-color: #667eea;
}

.page-item.active .page-link {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-color: #667eea;
}

.page-item.disabled .page-link {
  background: #f8f9fa;
  border-color: #e9ecef;
  color: #ced4da;
}

/* Responsive Design */
@media (max-width: 768px) {
  .news-filter-bar {
    flex-direction: column;
    gap: 0.75rem;
    align-items: stretch;
  }
  
  .filter-actions {
    flex-direction: column;
    width: 100%;
  }
  
  .btn-calendar-toggle,
  .btn-reset-filter {
    width: 100%;
    justify-content: center;
  }
  
  .filter-info {
    text-align: center;
  }
  
  .news-filter-section {
    padding: 1rem;
  }
  
  .calendar-filter-container {
    padding: 1rem;
  }
  
  .calendar-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.5rem;
  }
  
  .btn-close-calendar {
    align-self: flex-end;
  }
  
  .months-grid {
    grid-template-columns: repeat(4, 1fr);
    gap: 0.5rem;
  }
  
  .month-btn {
    padding: 0.5rem 0.25rem;
  }
  
  .days-grid {
    grid-template-columns: repeat(7, 1fr);
  }
  
  .news-item {
    flex-direction: column;
  }
  
  .news-date-marker {
    margin-right: 0;
    margin-bottom: 1rem;
  }
  
  .timeline-line {
    display: none;
  }
  
  .section-heading {
    font-size: 1.5rem;
    flex-wrap: wrap;
  }
  
  .news-count-badge {
    font-size: 0.75rem;
  }
}

@media (max-width: 576px) {
  .news-filter-bar {
    padding: 0.75rem;
  }
  
  .btn-calendar-toggle,
  .btn-reset-filter {
    font-size: 0.875rem;
    padding: 0.5rem 1rem;
  }
  
  .filter-info {
    font-size: 0.85rem;
  }
  
  .months-grid {
    grid-template-columns: repeat(3, 1fr);
  }
  
  .days-grid {
    grid-template-columns: repeat(5, 1fr);
  }
  
  .year-label {
    font-size: 1rem;
  }
  
  .filter-title {
    font-size: 1.1rem;
  }
  
  .section-heading {
    font-size: 1.25rem;
  }
  
  .date-circle {
    min-width: 60px;
    padding: 0.6rem;
  }
  
  .date-circle .day {
    font-size: 1.25rem;
  }
  
  .date-circle .month {
    font-size: 0.75rem;
  }
  
  .date-circle .year {
    font-size: 0.65rem;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const calendarToggleBtn = document.getElementById('calendar-toggle-btn');
  const calendarSection = document.getElementById('calendar-filter-section');
  const closeCalendarBtn = document.getElementById('close-calendar-btn');
  const resetFilterBtn = document.getElementById('reset-filter-btn');
  const filterInfo = document.getElementById('filter-info');
  const monthButtons = document.querySelectorAll('.month-btn.active');
  const newsItems = document.querySelectorAll('.news-item');
  const timelineTitle = document.getElementById('timeline-title');
  const newsCountBadge = document.getElementById('news-count-badge');
  
  let selectedMonth = null;
  let selectedDate = null;
  let currentDaysSelector = null;
  
  // Update news count badge
  function updateNewsCount(count) {
    if (count > 0) {
      newsCountBadge.textContent = count;
      newsCountBadge.style.display = 'inline-block';
    } else {
      newsCountBadge.style.display = 'none';
    }
  }
  
  // Initial count
  updateNewsCount(newsItems.length);
  
  // Toggle calendar visibility
  calendarToggleBtn.addEventListener('click', function() {
    if (calendarSection.style.display === 'none') {
      calendarSection.style.display = 'block';
      calendarToggleBtn.innerHTML = '<i class="fas fa-calendar-alt me-2"></i><span>Hide Calendar</span>';
    } else {
      calendarSection.style.display = 'none';
      calendarToggleBtn.innerHTML = '<i class="fas fa-calendar-alt me-2"></i><span>Filter by Date</span>';
    }
  });
  
  // Close calendar
  closeCalendarBtn.addEventListener('click', function() {
    calendarSection.style.display = 'none';
    calendarToggleBtn.innerHTML = '<i class="fas fa-calendar-alt me-2"></i><span>Filter by Date</span>';
  });
  
  // Reset filter
  resetFilterBtn.addEventListener('click', function() {
    monthButtons.forEach(b => b.classList.remove('selected'));
    document.querySelectorAll('.day-btn').forEach(d => d.classList.remove('selected'));
    document.querySelectorAll('.days-selector').forEach(ds => ds.style.display = 'none');
    selectedMonth = null;
    selectedDate = null;
    currentDaysSelector = null;
    showAllNews();
    resetFilterBtn.style.display = 'none';
    filterInfo.innerHTML = '<span class="text-muted">Showing all news</span>';
    filterInfo.classList.remove('active');
  });
  
  // Month filter functionality
  monthButtons.forEach(btn => {
    btn.addEventListener('click', function() {
      const month = this.getAttribute('data-month');
      const dates = JSON.parse(this.getAttribute('data-dates') || '[]');
      const yearSection = this.closest('.year-section');
      const daysSelector = yearSection.querySelector('.days-selector');
      
      // Hide previous days selector if different month
      if (currentDaysSelector && currentDaysSelector !== daysSelector) {
        currentDaysSelector.style.display = 'none';
      }
      
      // Toggle selection
      if (selectedMonth === month && !selectedDate) {
        // Deselect month
        this.classList.remove('selected');
        selectedMonth = null;
        daysSelector.style.display = 'none';
        showAllNews();
        resetFilterBtn.style.display = 'none';
        filterInfo.innerHTML = '<span class="text-muted">Showing all news</span>';
        filterInfo.classList.remove('active');
      } else {
        // Select new month
        monthButtons.forEach(b => b.classList.remove('selected'));
        this.classList.add('selected');
        selectedMonth = month;
        selectedDate = null;
        
        // Show days selector
        if (dates.length > 0) {
          renderDaysSelector(daysSelector, dates, month);
          daysSelector.style.display = 'block';
          currentDaysSelector = daysSelector;
        }
        
        filterByMonth(month);
        resetFilterBtn.style.display = 'inline-flex';
      }
    });
  });
  
  // Render days selector
  function renderDaysSelector(container, dates, month) {
    const daysGrid = container.querySelector('.days-grid');
    daysGrid.innerHTML = '';
    
    // Get unique dates and sort
    const uniqueDates = [...new Set(dates)].sort();
    
    uniqueDates.forEach(date => {
      const dayNum = new Date(date).getDate();
      const dayBtn = document.createElement('button');
      dayBtn.className = 'day-btn';
      dayBtn.textContent = dayNum;
      dayBtn.setAttribute('data-date', date);
      
      dayBtn.addEventListener('click', function() {
        const clickedDate = this.getAttribute('data-date');
        
        if (selectedDate === clickedDate) {
          // Deselect date, show all news in month
          this.classList.remove('selected');
          selectedDate = null;
          filterByMonth(month);
        } else {
          // Select date
          daysGrid.querySelectorAll('.day-btn').forEach(d => d.classList.remove('selected'));
          this.classList.add('selected');
          selectedDate = clickedDate;
          filterByDate(clickedDate);
        }
      });
      
      daysGrid.appendChild(dayBtn);
    });
  }
  
  // Filter by month
  function filterByMonth(month) {
    const [year, monthNum] = month.split('-');
    const monthName = new Date(year, parseInt(monthNum) - 1).toLocaleString('default', { month: 'long', year: 'numeric' });
    
    timelineTitle.textContent = `News from ${monthName}`;
    filterInfo.innerHTML = `<span>Filtered: ${monthName}</span>`;
    filterInfo.classList.add('active');
    
    let visibleCount = 0;
    newsItems.forEach(item => {
      const itemMonth = item.getAttribute('data-month');
      if (itemMonth === month) {
        item.classList.remove('hidden');
        visibleCount++;
      } else {
        item.classList.add('hidden');
      }
    });
    
    updateNewsCount(visibleCount);
    showNoNewsMessage(visibleCount);
  }
  
  // Filter by specific date
  function filterByDate(date) {
    const dateObj = new Date(date);
    const formattedDate = dateObj.toLocaleString('default', { month: 'long', day: 'numeric', year: 'numeric' });
    
    timelineTitle.textContent = `News on ${formattedDate}`;
    filterInfo.innerHTML = `<span>Filtered: ${formattedDate}</span>`;
    filterInfo.classList.add('active');
    
    let visibleCount = 0;
    newsItems.forEach(item => {
      const itemDate = item.getAttribute('data-date');
      if (itemDate === date) {
        item.classList.remove('hidden');
        visibleCount++;
      } else {
        item.classList.add('hidden');
      }
    });
    
    updateNewsCount(visibleCount);
    showNoNewsMessage(visibleCount);
  }
  
  // Show all news
  function showAllNews() {
    timelineTitle.textContent = 'Recent Updates';
    newsItems.forEach(item => {
      item.classList.remove('hidden');
    });
    updateNewsCount(newsItems.length);
    
    const newsContainer = document.getElementById('news-container');
    const noNewsMsg = newsContainer.querySelector('.no-news-message-filter');
    if (noNewsMsg) {
      noNewsMsg.remove();
    }
  }
  
  // Show no news message
  function showNoNewsMessage(count) {
    const newsContainer = document.getElementById('news-container');
    let noNewsMsg = newsContainer.querySelector('.no-news-message-filter');
    
    if (count === 0) {
      if (!noNewsMsg) {
        noNewsMsg = document.createElement('div');
        noNewsMsg.className = 'no-news-message no-news-message-filter';
        noNewsMsg.innerHTML = '<i class="fas fa-info-circle"></i><p>No news found for the selected date.</p>';
        newsContainer.appendChild(noNewsMsg);
      }
    } else {
      if (noNewsMsg) {
        noNewsMsg.remove();
      }
    }
  }
});
</script>

{{ end }}
