{{ define "main" }}
<article class="article article-simple">
  <div class="article-container pt-3">
    <h1>{{ .Title }}</h1>
    
    {{ with .Params.summary }}
    <div class="article-style">
      <p>{{ . }}</p>
    </div>
    {{ end }}

    <!-- Modern Calendar Filter -->
    <div class="news-filter-section mb-5">
      <div class="row">
        <div class="col-lg-12">
          <div class="calendar-filter-container">
            <h3 class="filter-title">
              <i class="fas fa-calendar-alt me-2"></i>Filter by Month
            </h3>
            <div class="calendar-grid" id="calendar-filter">
              {{ $currentYear := now.Year }}
              {{ $years := slice }}
              
              <!-- Collect all years from news posts -->
              {{ range .Site.RegularPages }}
                {{ if eq .Section "news" }}
                  {{ $year := .Date.Year }}
                  {{ if not (in $years $year) }}
                    {{ $years = $years | append $year }}
                  {{ end }}
                {{ end }}
              {{ end }}
              
              {{ $years = sort $years "value" "desc" }}
              
              <!-- Generate calendar for each year -->
              {{ range $years }}
                {{ $year := . }}
                <div class="year-section">
                  <h4 class="year-label">{{ $year }}</h4>
                  <div class="months-grid">
                    {{ range $month := (seq 12) }}
                      {{ $monthStr := printf "%d-%02d" $year $month }}
                      {{ $hasNews := false }}
                      {{ $newsCount := 0 }}
                      
                      <!-- Check if there are news in this month -->
                      {{ range $.Site.RegularPages }}
                        {{ if eq .Section "news" }}
                          {{ if eq (.Date.Format "2006-01") $monthStr }}
                            {{ $hasNews = true }}
                            {{ $newsCount = add $newsCount 1 }}
                          {{ end }}
                        {{ end }}
                      {{ end }}
                      
                      {{ $monthName := (time (printf "%d-%02d-01" $year $month)).Format "Jan" }}
                      {{ if $hasNews }}
                        <button class="month-btn active" data-month="{{ $monthStr }}" data-count="{{ $newsCount }}">
                          <span class="month-name">{{ $monthName }}</span>
                          <span class="news-badge">{{ $newsCount }}</span>
                        </button>
                      {{ else }}
                        <button class="month-btn disabled" disabled>
                          <span class="month-name">{{ $monthName }}</span>
                        </button>
                      {{ end }}
                    {{ end }}
                  </div>
                </div>
              {{ end }}
              
              <button class="btn btn-primary mt-3" id="show-all-btn">
                <i class="fas fa-list me-2"></i>Show All News
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- News Timeline -->
    <div class="news-timeline-section">
      <h3 class="section-heading mb-4">
        <i class="fas fa-newspaper me-2"></i>
        <span id="timeline-title">Recent Updates</span>
      </h3>
      
      <div class="news-timeline" id="news-container">
        {{ $paginator := .Paginate (where .Site.RegularPages "Section" "news").ByDate.Reverse }}
        
        {{ if eq (len $paginator.Pages) 0 }}
          <div class="no-news-message">
            <i class="fas fa-info-circle"></i>
            <p>No news items found.</p>
          </div>
        {{ end }}
        
        {{ range $paginator.Pages }}
        <div class="news-item" data-month="{{ .Date.Format "2006-01" }}">
          <div class="news-date-marker">
            <div class="date-circle">
              <span class="day">{{ .Date.Format "02" }}</span>
              <span class="month">{{ .Date.Format "Jan" }}</span>
            </div>
            <div class="timeline-line"></div>
          </div>
          
          <div class="news-content-card">
            <div class="card-header">
              <h4 class="news-title">
                <a href="{{ .RelPermalink }}">{{ .Title }}</a>
              </h4>
              <span class="news-date">{{ .Date.Format "January 2, 2006" }}</span>
            </div>
            
            <div class="card-body">
              {{ with .Params.summary }}
                <p class="news-summary">{{ . }}</p>
              {{ end }}
              
              {{ with .Params.tags }}
              <div class="news-tags">
                {{ range . }}
                  <span class="tag-badge">{{ . }}</span>
                {{ end }}
              </div>
              {{ end }}
            </div>
            
            <div class="card-footer">
              <a href="{{ .RelPermalink }}" class="read-more-link">
                Read more <i class="fas fa-arrow-right ms-1"></i>
              </a>
            </div>
          </div>
        </div>
        {{ end }}
      </div>

      <!-- Pagination -->
      {{ if gt $paginator.TotalPages 1 }}
      <nav class="pagination-nav mt-5">
        <ul class="pagination justify-content-center">
          {{ if $paginator.HasPrev }}
            <li class="page-item">
              <a class="page-link" href="{{ $paginator.Prev.URL }}" aria-label="Previous">
                <i class="fas fa-chevron-left"></i>
              </a>
            </li>
          {{ else }}
            <li class="page-item disabled">
              <span class="page-link"><i class="fas fa-chevron-left"></i></span>
            </li>
          {{ end }}
          
          {{ range $paginator.Pagers }}
            {{ if eq . $paginator }}
              <li class="page-item active">
                <span class="page-link">{{ .PageNumber }}</span>
              </li>
            {{ else }}
              <li class="page-item">
                <a class="page-link" href="{{ .URL }}">{{ .PageNumber }}</a>
              </li>
            {{ end }}
          {{ end }}
          
          {{ if $paginator.HasNext }}
            <li class="page-item">
              <a class="page-link" href="{{ $paginator.Next.URL }}" aria-label="Next">
                <i class="fas fa-chevron-right"></i>
              </a>
            </li>
          {{ else }}
            <li class="page-item disabled">
              <span class="page-link"><i class="fas fa-chevron-right"></i></span>
            </li>
          {{ end }}
        </ul>
      </nav>
      {{ end }}
    </div>
  </div>
</article>

<style>
/* Modern News Page Styles */
.news-filter-section {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 20px;
  padding: 2rem;
  box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
  margin-bottom: 3rem;
}

.calendar-filter-container {
  background: white;
  border-radius: 15px;
  padding: 2rem;
}

.filter-title {
  color: #667eea;
  font-size: 1.5rem;
  font-weight: 700;
  margin-bottom: 1.5rem;
  display: flex;
  align-items: center;
}

.year-section {
  margin-bottom: 2rem;
}

.year-label {
  color: #333;
  font-size: 1.25rem;
  font-weight: 600;
  margin-bottom: 1rem;
  padding-left: 0.5rem;
  border-left: 4px solid #667eea;
}

.months-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
  gap: 0.75rem;
  margin-bottom: 1rem;
}

.month-btn {
  position: relative;
  background: #f8f9fa;
  border: 2px solid #e9ecef;
  border-radius: 12px;
  padding: 0.75rem 0.5rem;
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: 500;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.25rem;
}

.month-btn:not(.disabled):hover {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-color: #667eea;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}

.month-btn.active {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-color: #667eea;
}

.month-btn.disabled {
  background: #f8f9fa;
  color: #ced4da;
  cursor: not-allowed;
  opacity: 0.5;
}

.month-btn.selected {
  background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
  color: white;
  border-color: #28a745;
  box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
}

.month-name {
  font-size: 0.875rem;
  font-weight: 600;
}

.news-badge {
  background: rgba(255, 255, 255, 0.9);
  color: #667eea;
  border-radius: 10px;
  padding: 0.125rem 0.5rem;
  font-size: 0.75rem;
  font-weight: 700;
  min-width: 24px;
}

.month-btn.selected .news-badge {
  color: #28a745;
}

.month-btn:hover .news-badge {
  background: rgba(255, 255, 255, 1);
}

#show-all-btn {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border: none;
  border-radius: 10px;
  padding: 0.75rem 2rem;
  font-weight: 600;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

#show-all-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

/* News Timeline Styles */
.section-heading {
  color: #333;
  font-size: 1.75rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  padding-bottom: 1rem;
  border-bottom: 3px solid #667eea;
}

.news-timeline {
  position: relative;
  padding-left: 1rem;
}

.news-item {
  display: flex;
  margin-bottom: 2rem;
  opacity: 1;
  transition: all 0.3s ease;
}

.news-item.hidden {
  display: none;
}

.news-date-marker {
  position: relative;
  margin-right: 2rem;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.date-circle {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 12px;
  padding: 0.75rem;
  color: white;
  text-align: center;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
  min-width: 70px;
  z-index: 2;
}

.date-circle .day {
  display: block;
  font-size: 1.5rem;
  font-weight: 700;
  line-height: 1;
}

.date-circle .month {
  display: block;
  font-size: 0.875rem;
  font-weight: 500;
  opacity: 0.9;
  text-transform: uppercase;
}

.timeline-line {
  position: absolute;
  top: 80px;
  left: 50%;
  transform: translateX(-50%);
  width: 3px;
  height: calc(100% + 2rem);
  background: linear-gradient(180deg, #667eea 0%, rgba(102, 126, 234, 0.1) 100%);
}

.news-item:last-child .timeline-line {
  display: none;
}

.news-content-card {
  flex: 1;
  background: white;
  border-radius: 15px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  transition: all 0.3s ease;
  overflow: hidden;
  border: 1px solid #e9ecef;
}

.news-content-card:hover {
  box-shadow: 0 8px 30px rgba(102, 126, 234, 0.2);
  transform: translateY(-4px);
}

.card-header {
  padding: 1.5rem;
  background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
  border-bottom: 1px solid #e9ecef;
}

.news-title {
  margin: 0 0 0.5rem 0;
  font-size: 1.25rem;
  font-weight: 700;
}

.news-title a {
  color: #333;
  text-decoration: none;
  transition: color 0.3s ease;
}

.news-title a:hover {
  color: #667eea;
}

.news-date {
  color: #6c757d;
  font-size: 0.875rem;
  font-weight: 500;
}

.card-body {
  padding: 1.5rem;
}

.news-summary {
  color: #555;
  line-height: 1.6;
  margin-bottom: 1rem;
}

.news-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.tag-badge {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 0.25rem 0.75rem;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 600;
}

.card-footer {
  padding: 1rem 1.5rem;
  background: #f8f9fa;
  border-top: 1px solid #e9ecef;
}

.read-more-link {
  color: #667eea;
  text-decoration: none;
  font-weight: 600;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
}

.read-more-link:hover {
  color: #764ba2;
  transform: translateX(4px);
}

.no-news-message {
  text-align: center;
  padding: 3rem;
  color: #6c757d;
}

.no-news-message i {
  font-size: 3rem;
  margin-bottom: 1rem;
  display: block;
}

/* Pagination Styles */
.pagination-nav {
  margin-top: 3rem;
}

.pagination {
  gap: 0.5rem;
}

.page-link {
  border-radius: 8px;
  border: 2px solid #e9ecef;
  color: #667eea;
  font-weight: 600;
  padding: 0.5rem 1rem;
  transition: all 0.3s ease;
}

.page-link:hover {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-color: #667eea;
}

.page-item.active .page-link {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-color: #667eea;
}

.page-item.disabled .page-link {
  background: #f8f9fa;
  border-color: #e9ecef;
  color: #ced4da;
}

/* Responsive Design */
@media (max-width: 768px) {
  .months-grid {
    grid-template-columns: repeat(4, 1fr);
    gap: 0.5rem;
  }
  
  .month-btn {
    padding: 0.5rem 0.25rem;
  }
  
  .news-item {
    flex-direction: column;
  }
  
  .news-date-marker {
    margin-right: 0;
    margin-bottom: 1rem;
  }
  
  .timeline-line {
    display: none;
  }
  
  .section-heading {
    font-size: 1.5rem;
  }
}

@media (max-width: 576px) {
  .months-grid {
    grid-template-columns: repeat(3, 1fr);
  }
  
  .news-filter-section {
    padding: 1rem;
  }
  
  .calendar-filter-container {
    padding: 1rem;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const monthButtons = document.querySelectorAll('.month-btn.active');
  const newsItems = document.querySelectorAll('.news-item');
  const showAllBtn = document.getElementById('show-all-btn');
  const timelineTitle = document.getElementById('timeline-title');
  
  let selectedMonth = null;
  
  // Month filter functionality
  monthButtons.forEach(btn => {
    btn.addEventListener('click', function() {
      const month = this.getAttribute('data-month');
      
      // Toggle selection
      if (selectedMonth === month) {
        // Deselect
        selectedMonth = null;
        this.classList.remove('selected');
        showAllNews();
      } else {
        // Select new month
        monthButtons.forEach(b => b.classList.remove('selected'));
        this.classList.add('selected');
        selectedMonth = month;
        filterByMonth(month);
      }
    });
  });
  
  // Show all button
  showAllBtn.addEventListener('click', function() {
    monthButtons.forEach(b => b.classList.remove('selected'));
    selectedMonth = null;
    showAllNews();
  });
  
  function filterByMonth(month) {
    const [year, monthNum] = month.split('-');
    const monthName = new Date(year, parseInt(monthNum) - 1).toLocaleString('default', { month: 'long', year: 'numeric' });
    
    timelineTitle.textContent = `News from ${monthName}`;
    
    let visibleCount = 0;
    newsItems.forEach(item => {
      const itemMonth = item.getAttribute('data-month');
      if (itemMonth === month) {
        item.classList.remove('hidden');
        visibleCount++;
      } else {
        item.classList.add('hidden');
      }
    });
    
    // Show message if no news found
    const newsContainer = document.getElementById('news-container');
    let noNewsMsg = newsContainer.querySelector('.no-news-message');
    
    if (visibleCount === 0) {
      if (!noNewsMsg) {
        noNewsMsg = document.createElement('div');
        noNewsMsg.className = 'no-news-message';
        noNewsMsg.innerHTML = '<i class="fas fa-info-circle"></i><p>No news found for this month.</p>';
        newsContainer.appendChild(noNewsMsg);
      }
    } else {
      if (noNewsMsg) {
        noNewsMsg.remove();
      }
    }
  }
  
  function showAllNews() {
    timelineTitle.textContent = 'Recent Updates';
    newsItems.forEach(item => {
      item.classList.remove('hidden');
    });
    
    const newsContainer = document.getElementById('news-container');
    const noNewsMsg = newsContainer.querySelector('.no-news-message');
    if (noNewsMsg) {
      noNewsMsg.remove();
    }
  }
});
</script>

{{ end }}
